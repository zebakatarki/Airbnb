<% layout("/layouts/boilerplate") %>
<!-- <style>
    label,input{
        margin: 0 !important;
        padding: 0 !important;
    }
</style> -->  
<!-- <h2>< msg %></h2> -->
<div class="row mt-3">
    <div class="col-8 offset-3 ">
        <h3><%= listing.title %></h3>
    </div>

    <div class="card col-6 offset-3 show-card listing-card">
        <img src="<%= listing.image %>" class="card-img-top show-img" alt="listing_image">
        <div class="card-body">
            <!-- //owner of post -->
            <p class="card-text">Owned by:<i><%= listing.owner.username %></i></p>
            <p><%= listing.description %></p>
            <p>&#8377;<%= listing.price.toLocaleString("en-IN")%></p>
            <p><%= listing.location %></p>
            <p><%= listing.country %></p>
            
            
        </div>
    </div>

    <!--1st authorisation of edit and delete button < if(currentUser && currentUser._id.equals(listing.owner._id)){ %>< } %> --> 
    <% if(currentUser && listing.owner._id.equals(currentUser._id)){ %>
        <div class="btns">
            <a href="/listings/<%= listing._id %>/edit" class="btn btn-dark col-1 offset-3 edit-btn ">Edit</a>
            <form method="post" action="/listings/<%= listing._id %>?_method=delete">
            <button class="btn btn-dark offset-5 delete ">Delete</button>
            <br>
            </form> 
            </div>    
    <br>
    <% } %>
    <!-- <form method="get" action="/listings/<= listing._id %>/reviews/template">
        <button type="submit" class="btn btn-dark  review mb-3"> Add Review </button>
    </form> -->
    
    <!-- <div class="offset-3">
    <h4>All Reviews</h4> -->
    <!-- <p><= listing.reviews %></p> -->
    <!-- <ul> -->
    <!-- < for(review of listing.reviews){%>
        <li><= review.Comment %>&nbsp;&nbsp;&nbsp;<b>,</b><= review.rating %> stars</li>
    < } %>
    </ul>
    </div> -->

    <!-- Displaying reviews in card form -->
    <!-- <div class="offset-3"> -->
    
    <div class="col-7 offset-3 mb-3 mt-4">
        <hr/>
    <p><b>All Reviews</b></p>
    <div class="row">
    <% for(review of listing.reviews){ %>
        <div class="card col-5 ms-3 mb-3">
            <div class="card-body">
                <h5 class="card-title">@<%= review.author.username  %></h5>
                <p class="card-text"><%= review.Comment %></p>
                <p class="card-text"><%= review.rating %> stars</p>
            </div>
            <form class="mb-3" method="post" action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=delete">
                <button class="btn btn-sm btn-dark">Delete</button>
            </form>
        </div>
    <% } %>
    </div>
    </div>   
    <br>
</div>

<form method="get" action="/listings/<%= listing._id %>/reviews"> 
    <button type="submit" class="btn btn-dark  review mb-3 offset-3"> Add Review </button>
</form>